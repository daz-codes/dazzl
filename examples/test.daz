# Dazzl Feature Showcase
# This file demonstrates all language features

# =============================================================================
# Variables and Basic Types
# =============================================================================

greeting = "Hello from Dazzl!"
x = 10
y = 20

print(greeting)

# Nil/null/undefined
empty = nil
also_null = null
not_defined = undefined

# Booleans
active = true
disabled = false

# Symbols (like Ruby/Elixir atoms)
status = :active
print(status)

# =============================================================================
# Strings
# =============================================================================

# Basic strings
name = "World"
single_quoted = 'no interpolation here: #{name}'

# String interpolation (double quotes only)
print("Hello #{name}!")
print("Math: 2 + 2 = #{2 + 2}")
print("Chained: #{String.upcase(name)}")

# Multiline strings
multiline = "Line 1
Line 2
Line 3"
print(multiline)

# =============================================================================
# Numbers and Operators
# =============================================================================

# Arithmetic
print(10 + 5)
print(10 - 5)
print(10 * 5)
print(10 / 4)

# Integer division and modulo
print(10 // 3)       # 3 (floor division)
print(17 % 5)        # 2 (modulo)
print(-17 // 5)      # -4 (floors toward negative infinity)

# Exponentiation (right-associative)
print(2 ** 10)       # 1024
print(2 ** 3 ** 2)   # 512 (= 2^9)

# Unary operators
print(-42)
print(+42)
print(-(-5))         # 5

# =============================================================================
# Arrays and Objects
# =============================================================================

# Arrays
empty_arr = []
numbers = [1, 2, 3, 4, 5]
mixed = ["hello", 42, true, nil]
print(numbers)

# Objects - three styles
obj1 = { name: "Alice", age: 30 }           # colon style
obj2 = { name => "Bob", age => 25 }         # hash rocket style
person_name = "Charlie"
person_age = 35
obj3 = { person_name, person_age }          # shorthand style
obj4 = { person_name, city: "NYC", active => true }  # mixed
print(obj1)
print(obj4)

# =============================================================================
# Functions
# =============================================================================

# Arrow-style with =>
add a, b => a + b
squared n => n * n
multiply a, b => a * b
triple n => n * 3

print(add(x, y))      # 30
print(squared(6))     # 36
print(multiply(3, 4)) # 12
print(triple(5))      # 15

# Block body with implicit return
clamp val, min, max => {
  if val < min { return min }
  if val > max { return max }
  val
}
print(clamp(50, 0, 100))   # 50
print(clamp(-10, 0, 100))  # 0

# =============================================================================
# Control Flow
# =============================================================================

result = 30

# If/else with optional parentheses
if result == 30 {
  print("Math works!")
} else {
  print("Something is wrong")
}

# Unless (negated if)
unless result == 0 {
  print("Result is not zero")
}

# Postfix conditionals
print("Postfix if works!") if result == 30
print("This won't print") unless result == 30

# Conditional expressions (like ternary)
level = if result > 50 "high" else "low"
sign = if result > 0 then "positive" else "non-positive"
grade = if result > 90 "A" else if result > 80 "B" else "C"
print("Level: #{level}, Sign: #{sign}, Grade: #{grade}")

# =============================================================================
# Pipe Operator
# =============================================================================

# Pipes pass the left side as the first argument
result |> add(5) |> print    # 35

# Works great with String module
"  HELLO  " |> String.trim |> String.downcase |> print  # "hello"

# =============================================================================
# Nil Checking
# =============================================================================

# nil == checks for both null AND undefined
maybe_null = null
maybe_undef = undefined
print(maybe_null == nil)   # true
print(maybe_undef == nil)  # true
print(42 == nil)           # false

# =============================================================================
# Ranges
# =============================================================================

my_range = [1..5]
print(Range.to_list(my_range))    # [1, 2, 3, 4, 5]
print(Range.size(my_range))       # 5
print(Range.member(my_range, 3))  # true

# =============================================================================
# Kernel Functions (auto-imported)
# =============================================================================

# Type checking
print(is_integer(42))
print(is_float(3.14))
print(is_binary("hello"))
print(is_sym(:test))
print(is_list([1, 2, 3]))
print(is_range(my_range))

# Utilities
print(abs(-5))
print(length("hello"))
print(inspect(:active))

# =============================================================================
# String Module (Elixir-style)
# =============================================================================

print(String.first("elixir"))           # "e"
print(String.last("elixir"))            # "r"
print(String.at("elixir", 2))           # "i"
print(String.at("elixir", -1))          # "r"
print(String.capitalize("hELLO"))       # "Hello"
print(String.reverse("dazzl"))          # "lzzad"
print(String.contains("hello", "ell"))  # true
print(String.pad_leading("42", 5, "0")) # "00042"
print(String.duplicate("na", 4))        # "nananana"

# =============================================================================
# Integer Module (Elixir-style)
# =============================================================================

print(Integer.is_even(42))        # true
print(Integer.is_odd(7))          # true
print(Integer.digits(1234))       # [1, 2, 3, 4]
print(Integer.digits(255, 16))    # [15, 15]
print(Integer.undigits([1, 2, 3]))# 123
print(Integer.gcd(12, 8))         # 4
print(Integer.pow(2, 10))         # 1024
print(Integer.to_string(255, 16)) # "ff"

# =============================================================================
# Pattern-Matching Functions
# =============================================================================

# Factorial with pattern matching
factorial 0 => 1
factorial n => n * factorial(n - 1)
print(factorial(5))   # 120
print(factorial(0))   # 1

# Fibonacci with pattern matching
fib 0 => 0
fib 1 => 1
fib n => fib(n - 1) + fib(n - 2)
print(fib(10))        # 55

# String pattern matching
greet "world" => "Hello World!"
greet name => "Hello #{name}!"
print(greet("world"))     # "Hello World!"
print(greet("Dazzl"))     # "Hello Dazzl!"

# Multiple parameters with wildcards
pair_type 0, 0 => "both zero"
pair_type 0, _ => "first zero"
pair_type _, 0 => "second zero"
pair_type _, _ => "neither zero"
print(pair_type(0, 0))    # "both zero"
print(pair_type(0, 5))    # "first zero"
print(pair_type(5, 0))    # "second zero"
print(pair_type(3, 7))    # "neither zero"

# Boolean pattern matching
to_yn true => "yes"
to_yn false => "no"
print(to_yn(true))        # "yes"
print(to_yn(false))       # "no"

# Guard clauses
fizzbuzz n if n % 15 == 0 => "FizzBuzz"
fizzbuzz n if n % 3 == 0 => "Fizz"
fizzbuzz n if n % 5 == 0 => "Buzz"
fizzbuzz n => n
print(fizzbuzz(15))       # "FizzBuzz"
print(fizzbuzz(9))        # "Fizz"
print(fizzbuzz(10))       # "Buzz"
print(fizzbuzz(7))        # 7

# =============================================================================
# Index Notation
# =============================================================================

# Array indexing
arr = [10, 20, 30, 40, 50]
print(arr[0])             # 10
print(arr[2])             # 30
print(arr[4])             # 50

# Dynamic index
idx = 1
print(arr[idx])           # 20
print(arr[idx + 1])       # 30

# Chained access
matrix = [[1, 2], [3, 4]]
print(matrix[0][1])       # 2
print(matrix[1][0])       # 3

# Object bracket access
obj = { name: "test", value: 42 }
print(obj["name"])        # "test"
print(obj["value"])       # 42

# Mixed dot and bracket notation
data = { items: [100, 200, 300] }
print(data.items[1])      # 200
